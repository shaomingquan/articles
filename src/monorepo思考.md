---
date: 2022-03-02
tags: javascript
---

### 问题

一个团队里大概率不只有一个项目，特别是做后台的团队，像是我们这边一堆的项目，整个团队对项目的开发迭代过程更像是一个**甘特图**，有的项目在长线迭代，有的可能偶尔短线迭代，以及各种新项目的启动。同时，前端的架构也在不断的迭代，包括：

- 打包升级
- 部署升级
- 工作流升级
- 质量体系升级
- 新的运行时lib
- ...

在架构演进 & 项目迭代过程中可能遇到的问题：

- 老项目逐渐脱节，维护体验差
- 新项目startup体验差，需要搞一堆东西，体验差
- 项目间复用困难

### 解法

需要面对的问题可以归纳为，**如何提高项目间联动能力，如何让基础建设造福新老项目，从而提高研发体验？**，从问题到手段，无外乎是项目间引用，以及项目对基础建设引用的手段，可能是：

- 基于npm registry的包分享 & 自研cli工具辅助
- monorepo

monorepo是一种更便捷的手段，能轻易的达到目的，在我的项目中，通过apps和package就轻松的把业务和基建隔离。相比于重度依赖npm registry，monorepo天然轻量，管理负担很轻

> ***实施成本与自发性***：实施成本越低，自发性越强，繁琐的方式vs简单的方式，达到同样效果一定是简单的更好。作为做工程的，我个人也希望减少不靠谱黑盒引入（某些cli），尽可能追求简单可控。

那么monorepo有没有问题？有：

- 对代码的读权限失控
- 代码一大堆，部分同学会觉得不清爽

如果对于读权限的控制需求强烈，可以用**git submodule+monorepo**，或者直接用个简单的脚本开发部署。

> ***一切皆是js***：node已具备对系统操作的能力，目前一切的基础设施都可以通过js模块化，并放在packages目录中，业务中按需对基础设施引入即可

### 小结

monorepo可以：
- 提升基础建设融入新老项目的体验，促进技术共建
- 提升项目间复用体验，促进业务共建
- 降低技术和业务耦合度，技术业务双轴发展
- 降低技术和业务的共建成本
