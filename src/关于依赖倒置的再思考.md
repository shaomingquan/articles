---
date: 2021-10-27
tags: 思考
---

### 要解决的问题

依赖倒置解决的问题是，传统的面向过程中分层抽象中，底层的改动容易影响上层业务的问题，进一步使上层业务的复用性变低。在通过面向对象的方法解决这个问题时，引出了依赖倒置的概念，依赖倒置要求上层提供协议，底层提供实践，相比于传统的依赖过程是相反的，且依赖更轻，模块间更独立。通常使用接口和抽象类这样的语言feature去实现。

> 我见到的一些代码，底层有业务逻辑，业务层又看不懂业务逻辑，读起来确实很头大。

### 延伸的思想

- 自上而下的架构：如果团队决定引入依赖倒置在项目中，那么在设计整个架构要优先考虑的是上层业务的特点，需要底层提供哪些能力，定义之后具体实现底层模块。
- 插件思想：插件模式也是依赖倒置的很好的例子，插件本身作为底层依赖要想加入到高层体系中，需要实现高层指定的interface。

### 不局限与面向对象

面向对象以外，可以用依赖倒置思想的case：

- typescript：ts中的鸭子类型，让依赖倒置变得更容易，我们需要定义很多interface。
- rpc：rpc也可以算个，不管是http也好，thrift也好，定义好接口了之后，作为client和server都不能任意迭代接口，而是基于接口迭代，接口拓展时也要重复考虑兼容性问题。

### 一个中间层

在思考依赖倒置解决的问题，本质上还是让业务和底层能减少耦合，避免太多杂糅以至于不可维护。除了接口，抽象类这样比较偏语言层的feature，中间层，或者说是代理也好，也能解决类似的问题。特别是实践中遇到接口谈不拢的时候，干脆别闹了，自己加个中间层算了。